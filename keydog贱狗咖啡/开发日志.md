###### 0611
* 10:33
  * resolveCustomEditor这个监听没有啥意义. 因为真正的保存也不在这里. 这里只是一个更新展示, 代表保存成功了. 除非那边的保存做在 onWillSaveTextDocument
  * 本来想的: 未来移出去, 用一个注册表管理
  * 但是发现, 其实可以用, 直接把分栏注册在 onWillSaveTextDocument 就OK了.
*10:38
  * 太牛逼了, CustomEditorProvider 直接实现了避免重复打开.ye文件的特性, 即便分栏打开也不会重复打开.
  # * 这个也很关键, 他会自动销毁注册的listener, 哈哈哈, 完美
  webviewPanel.onDidDispose -> saveListener.dispose()
* 10:46
  * onWillSaveTextDocument 注册分栏的保存事件, 调用save函数, 保存回ye.文件
  * onDidCloseTextDocument 注册分栏关闭事件, 调用save函数-保存ye文件, 调用closeall函数, 关闭所有相关内容.
    * 此事件要求能找到相关key, 所以分栏文件不该放到temp目录,而是应该放在原始文件旁边, 这样通过截取就能找到原始文件的路径?????
* 11:01
  * 代码要重构一下, 关键内容不能依赖vscode管理的对象的属性, 用映射表是更好的方案. 此时我需要几个映射表:
    * 需要清理的不是好映射表
      * ye文件的content映射表, 比较讨厌, 这个需要清理, 因此不用映射表继续放到webview的属性才是合理的, 因为他会跟随webview一起清理.
    * 不需要清理的才是好映射表:
      * 分栏到ye文件的映射表, 这样才能够正常保存回ye文件.
      * 分栏到全家的映射表, 这样关闭分栏时才可以联动. 此时其实不需要清理映射表. 
  * 结论: 只需要分栏到全家的映射表, 因为每次保存也是全家保存. 每次关闭也是全家关闭.
* 12:13
  * 之前询问claude, 他说只能tab轮询, 查到对应tab做关闭.
  * 问ds, 有不同的观点, 看一下.
* 16:49
  * 还剩两件事:
    * 保存文件, 这个要单独写个函数, 分栏保存和分栏关闭都要保存文件
    * 同步关闭, 在任何一个分栏关闭的时候, 都要同步关闭另外一个分栏, 以及原始文件.
* 17:02
  * 决定把注册事件都放在外边, 这样整体就清晰了, 并且也不需要做注销管理了. active自动管理.
* 18:47
  * 保存做好了, 休息一下, 然后调试下, 没啥问题就去写close.
* 19:39
  * 保存测试通过了. 还剩2件事:
  * 关闭时, 同时关闭
  * 获得焦点时, 同时显示
* 21:22
  * 我大概明白问题是什么了, 是出现了事件循环, 关闭a的时候, 会关闭b和父亲, 此时又触发了关闭b的事件,这里面又去关闭父亲和a......
  * 这个bug好狠, 幸亏代码是逐步添加逐步测试的, 不然根本想不到....
* 23:39
  * 困了, 去睡了.
###### 0610
* 9:32
  * coffee开发的文档放到了coffee项目: cofee
  * 目前一切正常, 尝试吧测试通道写进去, 然后就复制一份出来做开发
* 9:54
  * ok了, coffee项目ok, 可以copy出来了.
* 9:59
  * copy出来了, 试运行一下
  * ok, 完全正常, 俺休息一下.
* 10:47
  * 继续coffee
* 11:00
  * 上了趟厕所, 搞了红薯. 继续coffee
  * 发现自己coffee要恢复下
* 12:16
  * 刚刚下去看, 红薯竟然没有烤好, 加了时间
  * coffee文档看完了, 休息一下
* 13:06
  * 去吃个饭
* 13:57
  * 吃完了, 继续搞代码
  * 看了看language和grammar貌似没有, 从package里面删除了, 但是保存了一个copy2
* 14:38
  * 休息一下
* 14:44
  * 去休息, 休息前发现update写的有问题, 回来再说.
* 17:27
  * 睡得有点久了.
* 20:27
  * 休息了一下, 看了不少视频, 现在回来, 争取直接搞定这个编辑器. 这玩意也搞了5天了.
* 0:28
  * 看了一会儿视频, 忽然想起来之前那个漂亮的日语妹子不见了.
* 1:19
  * 找不到了, 完了, 估计是注销账号了.
  * 睡觉吧, 明天再搞, 只要关闭同步(且保存), 就结束了.
###### 0609
* 18:37
  * 终于回到了贱狗插件开发. 思考关闭源文件的时机, 放到新分栏建立时更合理, 但是, 依旧无法保证此时有文件可以关闭.
  * 所以还是去修改vscode的默认处理吧.
* 21:40
  * 尝试自定义编辑器
* 23:03
  * 使用doc.uri.fsPath来作为key
* 0:20
  * 刚才很困, 应该去睡觉, 现在去睡, 实在是无法忍受ts了. 换coffee. 现在的ts语法太难受了.

###### 0608
* 19:37
  * 果然不能熬夜, 前天熬了一下. 昨天貌似就没啥进度.


###### 0606
* 15:05
  * 抛弃了昨天那个webview思路. 改为原生分栏思路, 目前在看分栏方案的问题.
  * 我靠, 想明白了, 不能有右子树的指示标志, 只有左子树的.
    * 默认都是右子树, 直到碰到左子树标志.
    * 从第一个左子树标志开始都是左子树, 忽略后面所有标记.
  * 道理是这样的: 一个西瓜切两半, 只需要一刀, 不能因为西瓜是两半, 就切两刀. 那样西瓜必然至少3瓣
* 19:05
  * 5点睡醒后. 逛了一下steam, 没想到时间过得这么快. 饿了, 去搞吃的.
* 20:58
* markdown需要ts代码处理吗? 这个不能直接json设置吗? 咱们新加的这两个分栏编辑的内容就是markdown可不可以?
  另外, 我在 setupSync  看到了大量的防御性代码, 例如: if (isSaving) return;, 以及后面的try, 他们在干啥? 有必要吗?
  并且这个函数中报错: - [ts Error] Line 151: Property 'subscriptions' does not exist on type 'SuiteFunction'.
* 02:17
  * 从log看, 分栏可能失败.
  * 目前运行的时候, 如果不报错, 那么文件的行数, 瞬间会增长到458749行, 并且, 当前还有一个问题, 三个分栏看起来一毛一样, 我并不知道哪个是左分栏, 哪个是右分栏, 哪个是原文件.
* 2:43
  * 洗了澡之后
  * 仔细想了一下, 咱们可能有更简洁的方案: 
    * 当用户打开a.ye时, 我们并不直接打开a.ye, 而是, 直接建立两个临时文件: a.ye.左.md, a.ye.右.md, 然后分栏打开这两个文件. 
    * 然后, 我们也不需要搞同步机制, 只要用户关闭左.md时, 把右.md也关闭, 并且把他们两个的文件内容合并为a.ye, 然后删除掉这两个临时文件(可选, 不做似乎也没啥问题).
    * 这样我们就解决了所有问题: markdown格式, 无限分栏, 同步循环, 2个分栏的装饰区分......

* 4:10
  * 用户如果打开了多个ye文件, 是否能保证每次同时关闭对应的临时文件?
  * 同样的, 是否能保证某个临时文件切换到前台显示时, 另一个临时文件也切换出来, 因为每栏其实只有1个tab是展示状态, 也就是要保持这个展示状态同步.

* 总之, 先测试一下, 再做其它改进.

* 20:16
  * 咱们的代码运行时, 有个奇怪的表现, 打开某个ye文件之后, 虽然正常分栏展示了, 但是, 原本的那个ye文件并没有被关闭. 并且咱们的keydog通道显示: 
[19:57:52] KeyDog 插件已激活
[20:07:17] 处理文件: 文本文件示例-家谱.ye
[20:07:17] 创建临时文件: 文本文件示例-家谱.ye_left.md, 文本文件示例-家谱.ye_right.md
[20:07:17] 编辑器未找到: 文本文件示例-家谱.ye
[20:07:17] 已关闭原始文件
[20:07:17] 打开编辑器: 文本文件示例-家谱.ye_left.md
[20:07:17] 打开编辑器: 文本文件示例-家谱.ye_right.md
[20:07:17] 已打开临时文件分栏

可是报错是: 编辑器未找到, 也就是 if(editor)这里判断失败了, 你不论用啥方法, 在他里面搞, 应该没用吧? 并且别瞎改啊, 没报错的地方就别改了, 你改重复处理干嘛?  而且我想了这里面有个逻辑错误, 咱们在处理ye文件时, 实在打开事件上处理的, 此时ye还没有打开, 那么, 我们不是要关掉它, 而是要阻止事件冒泡, 停掉后面打开文件的操作, 这个才合逻辑对吧?

咱们要不先这样, 咱们先详细解释下核心概念vscode.workspace.onDidOpenTextDocument这样的vscode接口的具体含义咱们补一下. 比如这个接口触发的时候, 是个什么时候? 他们是一个什么样的事件顺序, 我们使用这个事件, 是否可以阻止vscode在editor展示ye文件?

###### 0605
* 10:27
  * 新建项目
* 11:29
  * 确定目录结构:
  * src/
├── extension.ts          # 入口
├── documentParser.ts     # 文档解析
├── editorProvider.ts     # 编辑器逻辑
└── webview/              # 前端资源
    ├── editor.html       # HTML模板
    ├── editor.css        # 样式
    └── editor.js         # 前端脚本
