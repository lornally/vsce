
###### 映射表
* 不需要清理的内容才放到映射表, 需要清理的内容放到对象属性, 随对象生命周期, 比如webview的内容content.
* 最适合的key: doc.uri.fsPath
* 分栏到全家的映射表, 
  * 保存分栏时, 要更新父文档
  * 关闭分栏时要联动. 此时其实不需要清理映射表. 

###### 事件
* vscode事件是全局共享的. 比如didclose, 所有文件关闭都会触发此事件.
  * 所以此时需要判断是否本文件, 在注册时可以用: 参数doc.uri.fsPath is 闭包(本文档)document.uri.fsPath
* 唤醒事件:
  * onWillSaveTextDocument 注册分栏的保存事件, 调用save函数, 保存回ye.文件
  * onDidCloseTextDocument 注册分栏关闭事件, 调用save函数-保存ye文件, 调用closeall函数, 关闭所有相关内容.

###### 处理tab/editor关闭
1. 轮询tab, 关闭对应tab, vscode.window.tabGroups.all
    .flatMap(group => group.tabs)
    .find(t => t.input instanceof vscode.TabInputText && t.input.uri.toString() === editor.document.uri.toString());
2. 用editor直接关闭tab
   vscode.commands.executeCommand('workbench.action.closeActiveEditor'); 这个应该是可以直接关闭, 但是他会先激活再关闭.
3. 记录tab
   用const activeTab = vscode.window.tabGroups.activeTabGroup.activeTab;这样就可以记录tab了. 但是打开editor时, 有一个preserveFocus是true, 这个就不行了.


* 不需要遍历的方法：
  workbench.action.closeActiveEditor：关闭当前活跃的编辑器
  workbench.action.closeEditorsInGroup：关闭指定分栏中的所有编辑器, 无法自由指定editor, 必须是一个column中的所有editor
  workbench.action.closeOtherEditors：关闭除当前外的其他编辑器
* 需要遍历的方法：
  vscode.window.tabGroups.close(tab)：需要先找到(或者存储的)Tab对象:
```coffee
closeTabByPath = (fsPath) ->
# 双循环
  for tabGroup in vscode.window.tabGroups.all
    for tab in tabGroup.tabs
      if tab.input?.uri?.toString() == uri.toString()
        await vscode.window.tabGroups.close(tab)
 
# 平铺
  target = vscode.window.tabGroups.all
    .flatMap((group) -> group.tabs)
    .find((t) -> t.input?.uri?.fsPath == fsPath)
  vscode.window.tabGroups.close(target) if target?


# 使用尾部for直接查找匹配的标签页, 这个本质还是双重循环
  target = tab for tab in group.tabs when tab.input?.uri?.fsPath is fsPath  for group in vscode.window.tabGroups.all                             
  vscode.window.tabGroups.close(target) if target?

# 真使用推导式, ai统统搞不定, 这一行也是错的
  # 一行式解决方案
  if tab = (t for g in vscode.window.tabGroups.all for t in g.tabs when t.input?.uri?.fsPath is fsPath)[0]
    vscode.window.tabGroups.close(tab)

```

###### 获得文档
* 代码
  uri = vscode.Uri.file filePath
  doc = await vscode.workspace.openTextDocument uri 
  editor = await vscode.window.showTextDocument doc, { viewColumn, preserveFocus }
* 对象说明
  uri - 只是文件路径标识符，不包含内容
  doc (TextDocument) - 包含文档的实时内容和元数据 ✅
  editor (TextEditor) - 编辑器视图，主要用于操作光标、选择等
* 文档内容
  doc.getText() 总是返回当前最新的文档内容
  即使用户在编辑器中修改了内容，doc 对象会自动更新
  不需要重新读取


###### 自动销毁
* webviewPanel.onDidDispose -> saveListener.dispose()

